<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Payment Preview - Food Business Academy</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body{
  font-family:'Poppins',sans-serif;
  background:#f4f6fb;
  padding:20px;
}
.container{
  max-width:480px;
  margin:auto;
  background:#fff;
  padding:20px;
  border-radius:16px;
  box-shadow:0 8px 25px rgba(0,0,0,0.08);
}
h2{text-align:center;margin-bottom:15px;}
p{margin:6px 0;font-size:14px;}

select,button{
  width:100%;
  padding:12px;
  margin-top:12px;
  border-radius:10px;
  border:1px solid #ddd;
}
button{
  background:#2563eb;
  color:#fff;
  font-weight:600;
  border:none;
  cursor:pointer;
}
button:hover{background:#6d28d9}

#invoicePopup{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.6);
  z-index:9999;
}
#invoiceBox{
  background:#fff;
  max-width:420px;
  margin:10% auto;
  padding:20px;
  border-radius:16px;
}
.greenBtn{background:#22c55e;}
.blueBtn{background:#0ea5e9;}
</style>
</head>

<body>

<div class="container">
  <h2>Payment Preview</h2>

  <p><strong>Name:</strong> <span id="name"></span></p>
  <p><strong>Email:</strong> <span id="email"></span></p>
  <p><strong>Course:</strong> <span id="course"></span></p>
  <p><strong>Amount:</strong> $<span id="price"></span></p>

  <select id="method">
    <option value="Ecocash">Ecocash</option>
    <option value="Bank Transfer">Bank Transfer</option>
    <option value="One Money">One Money</option>
  </select>

  <button type="button" onclick="proceedPayment()">Proceed to Payment</button>
</div>

<!-- INVOICE POPUP -->
<div id="invoicePopup">
  <div id="invoiceBox">
    <h3>Payment Invoice</h3>
    <p><strong>Invoice No:</strong> <span id="invoiceNo"></span></p>

    <p id="invoiceDetails"></p>

    <p><strong>Payment Instructions</strong></p>
    <p>
      üè¶ Bank: CBZ / FBC<br>
      üí∞ Ecocash: 0773371163<br>
      üì± One Money: 0718625498<br>
      üìå Reference: Invoice Number
    </p>

    <button class="blueBtn" onclick="downloadPDF()">Download Invoice PDF</button>
    <button class="greenBtn" onclick="goBack()">Back to Courses</button>
  </div>
</div>

<script>
const name  = localStorage.getItem("studentName") || "";
const email = localStorage.getItem("studentEmail") || "";

const course = localStorage.getItem("courseName") || "";
const price  = localStorage.getItem("coursePrice") || "";

const invoiceNumber = "FBA-" + Date.now();

document.getElementById("name").textContent = name;
document.getElementById("email").textContent = email;
document.getElementById("course").textContent = course;
document.getElementById("price").textContent = price;
document.getElementById("invoiceNo").textContent = invoiceNumber;

function proceedPayment(){
  /* STORE COURSE STATUS */
  const statusData = JSON.parse(localStorage.getItem("courseStatus")) || {};
  if(!statusData[email]) statusData[email] = {};
  statusData[email][course] = "pending";
  localStorage.setItem("courseStatus", JSON.stringify(statusData));

  document.getElementById("invoiceDetails").innerHTML = `
    <strong>Name:</strong> ${name}<br>
    <strong>Email:</strong> ${email}<br>
    <strong>Course:</strong> ${course}<br>
    <strong>Amount:</strong> $${price}<br>
    <strong>Status:</strong> Pending Payment
  `;

  document.getElementById("invoicePopup").style.display = "block";
}

function downloadPDF(){
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  doc.setFontSize(16);
  doc.text("Food Business Academy",20,20);
  doc.setFontSize(12);
  doc.text(`Invoice No: ${invoiceNumber}`,20,35);
  doc.text(`Name: ${name}`,20,45);
  doc.text(`Course: ${course}`,20,55);
  doc.text(`Amount: $${price}`,20,65);
  doc.text("Status: Pending Payment",20,80);
  doc.save(`${invoiceNumber}.pdf`);
}

function goBack(){
  window.location.href = "courses.html";
}
</script>

</body>
</html>
