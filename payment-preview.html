<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Payment Preview - Food Business Academy</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<style>
:root {
  --primary:#4f46e5;
  --secondary:#7c3aed;
  --gradient:linear-gradient(135deg,#4f46e5,#7c3aed);
  --bg:#f3f4f6;
  --card:#fff;
  --text:#1f2937;
  --muted:#6b7280;
}
*{box-sizing:border-box;margin:0;padding:0}
body{
  font-family:Poppins,sans-serif;
  background:var(--bg);
  display:flex;
  justify-content:center;
  align-items:center;
  min-height:100vh;
  padding:20px;
  opacity:0;
  transition:.4s;
}
body.loaded{opacity:1}
.container{
  max-width:500px;width:100%;
  background:var(--card);
  padding:40px 30px;
  border-radius:20px;
  box-shadow:0 20px 40px rgba(0,0,0,.15);
  text-align:center;
}
.logo-img{max-width:150px;margin:0 auto 20px}
.sub-text{color:var(--muted);margin-bottom:20px}
.details-box{
  background:#f9fafb;
  border-radius:12px;
  padding:20px;
  text-align:left;
  margin-bottom:20px;
}
.detail-row{display:flex;justify-content:space-between;margin-bottom:10px}
.label{color:var(--muted)}
.value{font-weight:600;color:var(--primary)}
.payment-grid{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:10px;
  margin-bottom:20px;
}
.payment-card{
  border:2px solid #e5e7eb;
  border-radius:12px;
  height:80px;
  display:flex;
  justify-content:center;
  align-items:center;
  cursor:pointer;
}
.payment-card.active{
  border-color:var(--secondary);
  background:#f5f3ff;
}
.payment-card img{max-width:90%;max-height:90%}
.main-btn{
  width:100%;
  padding:15px;
  border:none;
  border-radius:12px;
  background:var(--gradient);
  color:#fff;
  font-weight:600;
  cursor:pointer;
}
</style>
</head>

<body>
<div class="container">
<img class="logo-img" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhIuGx_Tl93TWp5OZYxIn7iCPb3FhwXGTZTr_xVjfUAOy4dt2YzXq0c7H4VizrvCBNkCO12IlSymo4R-7Nq9mSffdpB9w6Yge3O2i0UovqE45XIW1jEyvZJg6sOjDfUUhdRJs2x_Bqui6goNnXmcV8hguXwcIUqsvMv5-kY-yNeo-Onr9TVspl88fBfiEsV/s1600/IMG-20251223-WA0001.png">

<h2>Enrollment Summary</h2>
<p class="sub-text">Please review your details</p>

<div class="details-box">
  <div class="detail-row"><span class="label">Email</span><span class="value" id="displayEmail">...</span></div>
  <div class="detail-row"><span class="label">Course</span><span class="value" id="displayCourse">...</span></div>
  <div class="detail-row"><span class="label">Total</span><span class="value" id="displayPrice">$0</span></div>
</div>

<input type="hidden" id="method" value="Ecocash">

<div class="payment-grid">
  <div class="payment-card active" onclick="selectPayment('Ecocash',this)">
    <img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhCOPxJALDl8rinCr4j5gKvHQCpFn5RjSNX4o2ZgKZdus_g_naLRz35VcSQknCqVYUWWrhpmE_f3OOPgnjByqIM4JFYeB_0ZKCQxlRgesgK5PoPxo4JjacOmrmyTXpzf-bAfc6ZEt8_88LFQZEEUN1p9yb-zdoqKA8UrGntxMjWrC6dcYZQi0rK3i27jDOa/s1600/EcoCash%20%281%29.png">
  </div>
  <div class="payment-card" onclick="selectPayment('Bank Transfer',this)">
    <img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEitQyz359bQN-qUKKbaBPz0pEF11jeXScTl4rmkmeWpLqLFnm42tZ6eolAZJVx1kdGxo8gxgtLKPWOJZ1l4A_yr3HQXk4gar_xvwrQg6UXRQBzfzmN4b4wNsvbdmrK8_56qX2p1vAQFckXv-S2e-6C78GtoLe1T3J156Pq8kz17imMQX8SjF9CSpl4Txujj/s1600/%5BCITYPNG.COM%5DMasterCard%20&%20Visa%20Cards%20Logos%20Icons%20-%201500x1500.png">
  </div>
  <div class="payment-card" onclick="selectPayment('One Money',this)">
    <img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgBFwR6y4tJP-_NQ_l2TspkmOZOd4c4lHPbTjhqdD_r68NAdzPTZxjW7Ns1ZcMQMch1b8yd1HMzcw7EKkdyJDxUwfNgsdRDZJnMy16a2ldFRV95MOsiqelfNMlsV9L_dXgow0019mQ9uNa6DTSYGYCB6xYXVhaur-1AGfnqalmHqesEG0z-XViwC81MwON1/s1600/2d0d78c7-f8c3-4169-8a6c-81b036eb2796.jpg">
  </div>
</div>

<button class="main-btn" onclick="proceedPayment()">Generate Invoice</button>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig={
  apiKey:"AIzaSyC_lKWa4cM4cT337KkRw4sp7raQHl9aZWk",
  authDomain:"students-login-29409.firebaseapp.com",
  projectId:"students-login-29409"
};
firebase.initializeApp(firebaseConfig);
const db=firebase.firestore();

const params=new URLSearchParams(window.location.search);
const courseName=params.get("name")||localStorage.getItem("courseName");
const coursePrice=params.get("price")||localStorage.getItem("coursePrice");
let studentEmail="";

firebase.auth().onAuthStateChanged(async user=>{
  if(!user){window.location.href="index.html";return;}
  studentEmail=user.email;

  displayEmail.textContent=studentEmail;
  displayCourse.textContent=courseName;
  displayPrice.textContent="$"+coursePrice;

  const courseRef=db.collection("enrollments")
    .doc(studentEmail)
    .collection("courses")
    .doc(courseName);

  const snap=await courseRef.get();

  if(snap.exists){
    window.location.href="student.html";
    return;
  }

  document.body.classList.add("loaded");
});

function selectPayment(method,el){
  document.getElementById("method").value=method;
  document.querySelectorAll(".payment-card").forEach(c=>c.classList.remove("active"));
  el.classList.add("active");
}

async function proceedPayment(){
  const method=document.getElementById("method").value;
  const courseRef=db.collection("enrollments")
    .doc(studentEmail)
    .collection("courses")
    .doc(courseName);

  const snap=await courseRef.get();
  if(snap.exists){
    window.location.href="student.html";
    return;
  }

  const invoiceNumber="FBA-"+Math.floor(100000+Math.random()*900000);

  await courseRef.set({
    status:"pending",
    invoiceNumber:invoiceNumber,
    paymentMethod:method,
    createdAt:firebase.firestore.FieldValue.serverTimestamp()
  });

  window.location.href="student.html";
}
</script>
</body>
                            </html>
