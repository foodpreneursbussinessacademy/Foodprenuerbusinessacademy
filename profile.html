<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>My Profile | Food Business Academy</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

<style>
*,*::before,*::after{box-sizing:border-box}
body{margin:0;font-family:'Poppins',sans-serif;background:#f4f6fb;color:#1f2937;overflow-x:hidden}
.container{max-width:720px;width:100%;margin:0 auto;padding:40px 16px}
.card{width:100%;background:#fff;border-radius:22px;padding:28px;box-shadow:0 20px 45px rgba(0,0,0,.08)}
.header{text-align:center;margin-bottom:32px}
.avatar{width:100px;height:100px;border-radius:50%;background:linear-gradient(135deg,#2563eb,#6d28d9);display:flex;align-items:center;justify-content:center;color:#fff;font-size:36px;font-weight:700;margin:0 auto 12px}
.subtitle{color:#6b7280;font-size:14px}
.section{margin-bottom:26px}
.section-title{font-weight:700;margin-bottom:14px}
.input{display:flex;flex-direction:column;gap:6px;margin-bottom:14px}
label{font-size:14px;font-weight:600}
input,textarea,select{width:100%;padding:12px 14px;border-radius:14px;border:1px solid #e5e7eb;font-family:inherit}
textarea{resize:none}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
.readonly{background:#f9fafb}
button{width:100%;padding:14px;border:none;border-radius:18px;background:linear-gradient(135deg,#2563eb,#6d28d9);color:#fff;font-weight:600;cursor:pointer}
button:hover{opacity:.95}
@media(max-width:600px){.grid{grid-template-columns:1fr}.card{padding:22px}}
</style>
</head>

<body>

<div class="container">
  <div class="card">

    <div class="header">
      <div class="avatar" id="avatar">S</div>
      <h2 id="studentName">Student Name</h2>
      <p class="subtitle">Student ID: <span id="studentId">â€”</span></p>
    </div>

    <div class="section">
      <div class="section-title">Personal Information</div>
      <div class="grid">
        <div class="input">
          <label>Full Name</label>
          <input id="fullName" placeholder="Your full name">
        </div>
        <div class="input">
          <label>Email Address</label>
          <input id="email" class="readonly" disabled>
        </div>
      </div>
      <div class="grid">
        <div class="input">
          <label>Phone Number</label>
          <input id="phone" placeholder="+263...">
        </div>
        <div class="input">
          <label>Date of Birth</label>
          <input type="date" id="dob">
        </div>
      </div>
      <div class="grid">
        <div class="input">
          <label>Gender</label>
          <select id="gender">
            <option value="">Select Gender</option>
            <option value="Male">Male</option>
            <option value="Female">Female</option>
            <option value="Other">Other</option>
          </select>
        </div>
        <div class="input">
          <label>Address</label>
          <input id="address" placeholder="Address">
        </div>
      </div>
      <div class="grid">
        <div class="input">
          <label>City</label>
          <input id="city" placeholder="City">
        </div>
        <div class="input">
          <label>Country</label>
          <input id="country" placeholder="Country">
        </div>
      </div>
    </div>

    <div class="section">
      <div class="section-title">About You</div>
      <div class="input">
        <label>Short Bio</label>
        <textarea id="bio" rows="3" placeholder="Tell us a little about yourself"></textarea>
      </div>
    </div>

    <button onclick="saveProfile()">Save Changes</button>

  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
firebase.initializeApp({
  apiKey:"AIzaSyC_lKWa4cM4cT337KkRw4sp7raQHl9aZWk",
  authDomain:"students-login-29409.firebaseapp.com",
  projectId:"students-login-29409"
});

const auth = firebase.auth();
const db = firebase.firestore();

auth.onAuthStateChanged(async user=>{
  if(!user) return window.location.href='index.html';

  studentId.textContent = user.uid.slice(0,8);
  email.value = user.email;

  const ref = db.collection("students").doc(user.uid);
  const snap = await ref.get();

  if(snap.exists){
    const d = snap.data();
    studentName.textContent = d.fullName || user.email.split("@")[0];
    fullName.value = d.fullName || "";
    phone.value = d.phone || "";
    address.value = d.address || "";
    dob.value = d.dob || "";
    gender.value = d.gender || "";
    city.value = d.city || "";
    country.value = d.country || "";
    bio.value = d.bio || "";
  }

  avatar.textContent = (fullName.value || studentName.textContent || "S")[0].toUpperCase();
});

async function saveProfile(){
  const user = auth.currentUser;
  if(!user) return;

  const dataToUpdate = {
    fullName: fullName.value,
    phone: phone.value,
    address: address.value,
    dob: dob.value,
    gender: gender.value,
    city: city.value,
    country: country.value,
    bio: bio.value,
    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
  };

  await db.collection("students").doc(user.uid).set(dataToUpdate, {merge:true});

  alert("Profile updated successfully!");
}
</script>

</body>
</html>
