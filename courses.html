<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Courses | Food Business Academy</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<style>
:root {
  /* Brand Colors */
  --primary-dark: #1e1b4b;   /* Deep Indigo */
  --primary: #4f46e5;        /* Vibrant Blue */
  --secondary: #7c3aed;      /* Vivid Purple */
  
  /* Accent Colors */
  --accent-yellow: #f59e0b;  /* Amber/Gold */
  --accent-red: #dc2626;     /* Red */
  --accent-green: #10b981;   /* Emerald */

  /* Neutrals */
  --bg-color: #f8fafc;
  --card-bg: #ffffff;
  --text-main: #0f172a;
  --text-muted: #64748b;
  
  /* Effects */
  --glass: rgba(255, 255, 255, 0.95);
  --shadow-sm: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
  --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
}

* { box-sizing: border-box; font-family: 'Outfit', sans-serif; }

body {
  margin: 0;
  background-color: var(--bg-color);
  color: var(--text-main);
  padding-bottom: 60px;
}

/* --- HEADER --- */
header {
  background: linear-gradient(135deg, var(--primary-dark), var(--secondary));
  padding: 20px 5%;
  color: white;
  box-shadow: 0 4px 20px rgba(79, 70, 229, 0.2);
  display: flex;
  justify-content: space-between;
  align-items: center;
  flex-wrap: wrap;
  gap: 20px;
}

.brand h2 { margin: 0; font-weight: 800; letter-spacing: -0.5px; font-size: 1.5rem; }
.brand span { color: var(--accent-yellow); }

.user-panel {
  display: flex;
  align-items: center;
  gap: 15px;
  background: rgba(255,255,255,0.1);
  padding: 8px 16px;
  border-radius: 50px;
  backdrop-filter: blur(5px);
  border: 1px solid rgba(255,255,255,0.1);
}

.user-avatar {
  width: 35px; height: 35px;
  background: var(--accent-yellow);
  color: var(--primary-dark);
  border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  font-weight: 700;
}

.user-details { display: flex; flex-direction: column; line-height: 1.2; }
.user-details span { font-size: 0.85rem; font-weight: 600; }
.user-details small { font-size: 0.7rem; opacity: 0.8; }

/* --- HERO SECTION --- */
.hero {
  text-align: center;
  padding: 50px 20px;
  max-width: 800px;
  margin: 0 auto;
}
.hero h1 {
  font-size: 2.8rem;
  margin-bottom: 10px;
  background: linear-gradient(to right, var(--primary), var(--secondary));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  font-weight: 800;
}
.hero p { color: var(--text-muted); font-size: 1.1rem; }

/* --- GRID LAYOUT --- */
.container { max-width: 1200px; margin: 0 auto; padding: 0 20px; }
.grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
  gap: 30px;
}

/* --- ADVANCED CARD DESIGN --- */
.course-card {
  background: var(--card-bg);
  border-radius: 20px;
  overflow: hidden;
  box-shadow: var(--shadow-sm);
  border: 1px solid #e2e8f0;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  display: flex;
  flex-direction: column;
  position: relative;
}

.course-card:hover {
  transform: translateY(-8px);
  box-shadow: var(--shadow-lg);
  border-color: var(--secondary);
}

/* Top Decoration Line */
.card-top-accent {
  height: 6px;
  background: linear-gradient(90deg, var(--primary), var(--secondary));
  width: 100%;
}

.card-body { padding: 30px; flex-grow: 1; }

/* Header Area */
.card-header { margin-bottom: 20px; }
.card-title {
  font-size: 1.5rem;
  font-weight: 700;
  color: var(--primary-dark);
  margin: 0 0 10px 0;
  line-height: 1.3;
}

/* Status Badge */
.badge {
  position: absolute;
  top: 20px;
  right: 20px;
  padding: 5px 12px;
  border-radius: 6px;
  font-size: 0.7rem;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}
.badge.approved { background: #dcfce7; color: #15803d; border: 1px solid #86efac; }
.badge.pending { background: #fef3c7; color: #b45309; border: 1px solid #fcd34d; }

/* Overview Text */
.label {
  font-size: 0.75rem;
  text-transform: uppercase;
  letter-spacing: 1px;
  color: var(--primary);
  font-weight: 700;
  margin-bottom: 8px;
  display: block;
}
.overview-text {
  font-size: 0.95rem;
  color: var(--text-muted);
  line-height: 1.6;
  margin-bottom: 25px;
  border-left: 3px solid #e2e8f0;
  padding-left: 15px;
}

/* Curriculum List */
.curriculum {
  list-style: none;
  padding: 0;
  margin: 0;
}
.curriculum li {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 12px;
  font-size: 0.9rem;
  color: var(--text-main);
  font-weight: 500;
}
.curriculum li::before {
  content: "âœ“";
  display: inline-flex;
  align-items: center;
  justify-content: center;
  min-width: 20px; height: 20px;
  background: #ede9fe;
  color: var(--secondary);
  border-radius: 50%;
  font-size: 12px;
  font-weight: bold;
}

/* Footer & Actions */
.card-footer {
  padding: 20px 30px;
  background: #f8fafc;
  border-top: 1px solid #f1f5f9;
}

.price-area {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 15px;
}
.price-label { font-size: 0.9rem; color: var(--text-muted); }
.price-val { 
  font-size: 1.6rem; 
  font-weight: 800; 
  color: var(--accent-yellow); /* Yellow for Money */
  text-shadow: 1px 1px 0px rgba(0,0,0,0.1);
}
.price-val small { font-size: 1rem; color: var(--text-muted); font-weight: 500; }

/* Buttons */
.btn {
  width: 100%;
  padding: 14px;
  border: none;
  border-radius: 10px;
  font-weight: 600;
  font-size: 1rem;
  cursor: pointer;
  transition: transform 0.2s;
}
.btn:active { transform: scale(0.98); }

.btn-pay {
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  color: white;
  box-shadow: 0 4px 15px rgba(124, 58, 237, 0.3);
}
.btn-pay:hover { filter: brightness(110%); }

.btn-access {
  background: var(--accent-green);
  color: white;
  box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
}

.btn-pending {
  background: #cbd5e1;
  color: #475569;
  cursor: not-allowed;
}

.link-cancel {
  display: block;
  text-align: center;
  margin-top: 10px;
  color: var(--accent-red); /* Red for Danger */
  font-size: 0.85rem;
  text-decoration: none;
  font-weight: 500;
  cursor: pointer;
}
.link-cancel:hover { text-decoration: underline; }

/* Loading State */
.loading-box { grid-column: 1/-1; text-align: center; padding: 40px; color: var(--text-muted); }

/* Mobile */
@media(max-width: 600px) {
  header { flex-direction: column; text-align: center; }
  .hero h1 { font-size: 2rem; }
}
</style>
</head>

<body>

<header>
  <div class="brand">
    <h2>Foodprenuers Business<span>Academy</span></h2>
  </div>
  <div class="user-panel">
    <div class="user-avatar" id="avatarLetter">U</div>
    <div class="user-details">
      <span id="studentEmail">Loading...</span>
      <small id="studentId">ID: ...</small>
    </div>
  </div>
</header>

<div class="hero">
  <h1>Advance Your Career</h1>
  <p>Select a specialized course below to view the curriculum and enroll today.</p>
</div>

<main class="container">
  <div class="grid" id="coursesGrid">
    <div class="loading-box">Loading Academy Courses...</div>
  </div>
</main>

        <script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
import { getFirestore, doc, getDoc, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyC_lKWa4cM4cT337KkRw4sp7raQHl9aZWk",
  authDomain: "students-login-29409.firebaseapp.com",
  projectId: "students-login-29409",
  storageBucket: "students-login-29409.firebasestorage.app",
  messagingSenderId: "634331456872",
  appId: "1:634331456872:web:6dae360c5e28d8356562dd",
  measurementId: "G-96XXYG1VR2"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const courses = [
  { name: "Food Business Management Course", price: 49, overview: "Master the ecosystem of running a compliant food business.", curriculum: ["Business Models", "Compliance", "Digital Marketing"] },
  { name: "Financial Management for Food Processors", price: 59, overview: "Learn unit costing, yield analysis, and profit maximization.", curriculum: ["Costing", "Pricing Strategy", "Cash Flow"] },
  { name: "Food Value Addition Course for Farmers", price: 45, overview: "Turn raw produce into high-value branded products.", curriculum: ["Post-Harvest", "Packaging", "Branding"] },
  { name: "New Product Development and Management", price: 69, overview: "Go from kitchen recipe to supermarket shelf-ready.", curriculum: ["Prototyping", "Sensory Eval", "Regulatory"] },
  { name: "Management", price: 39, overview: "Leadership tactics for high-pressure food environments.", curriculum: ["Leadership", "Ethics", "Decision Making"] }
];

onAuthStateChanged(auth, async (user) => {
  if (!user) {
    window.location.href = "login.html";
    return;
  }

  const email = user.email;
  document.getElementById("studentEmail").textContent = email;
  document.getElementById("avatarLetter").textContent = email.charAt(0).toUpperCase();

  // 1. Check Paid Courses (Firestore)
  const studentSnap = await getDoc(doc(db, "students", user.uid));
  const paidCourses = studentSnap.exists() ? (studentSnap.data().coursesPaid || []) : [];

  // 2. Check Pending Payments (Firestore)
  const payQuery = query(collection(db, "payments"), where("studentId", "==", user.uid), where("status", "==", "pending"));
  const paySnap = await getDocs(payQuery);
  let pendingCourses = paySnap.docs.map(d => d.data().courseName);

  // 3. Check LocalStorage (The "Immediate" Status)
  const localStatus = JSON.parse(localStorage.getItem("courseStatus")) || {};
  const studentLocalData = localStatus[email] || {};
  
  // Combine Firestore pending and LocalStorage pending
  Object.keys(studentLocalData).forEach(courseName => {
    if (studentLocalData[courseName] === "pending" && !pendingCourses.includes(courseName)) {
      pendingCourses.push(courseName);
    }
  });

  renderCourses(paidCourses, pendingCourses);
});

function renderCourses(paid, pending) {
  const grid = document.getElementById("coursesGrid");
  grid.innerHTML = "";

  courses.forEach(course => {
    let statusBadge = "";
    let actionBtn = `<button class="btn btn-enroll" onclick="enroll('${course.name}', ${course.price})">Enroll Now</button>`;

    if (paid.includes(course.name)) {
      statusBadge = `<div class="badge" style="background:#dcfce7; color:#15803d;">Active</div>`;
      actionBtn = `<button class="btn btn-access" onclick="openCourse('${course.name}')">Enter Classroom</button>`;
    } else if (pending.includes(course.name)) {
      statusBadge = `<div class="badge">Pending Payment</div>`;
      actionBtn = `<button class="btn" style="background:#e2e8f0; color:#64748b;" disabled>Waiting for Approval...</button>`;
    }

    grid.innerHTML += `
      <div class="course-card">
        <div class="card-accent"></div>
        <div class="card-body">
          ${statusBadge}
          <h3 class="card-title">${course.name}</h3>
          <span class="label">Overview</span>
          <p class="overview">${course.overview}</p>
          <span class="label">Includes</span>
          <ul class="curriculum">${course.curriculum.map(c => `<li>${c}</li>`).join("")}</ul>
        </div>
        <div class="card-footer">
          <div class="price-row">
            <span style="color:var(--text-muted); font-size:0.9rem;">Course Fee</span>
            <span class="price">$${course.price}</span>
          </div>
          ${actionBtn}
        </div>
      </div>
    `;
  });
}

window.enroll = (name, price) => {
  window.location.href = `student-details.html?name=${encodeURIComponent(name)}&price=${price}`;
};

window.openCourse = (name) => {
  alert("Opening " + name);
};
        </script>
