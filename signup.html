<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Food Business Academy | Sign Up</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />

<style>
:root{
  --purple:#6d28d9;
  --blue:#2563eb;
  --light-bg:#f0f5ff;
  --text:#1f2937;
  --accent:#ff7f50;
}

*{box-sizing:border-box;font-family:'Poppins',sans-serif}
body{
  margin:0;
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
  background:linear-gradient(135deg,#eef2ff,#f9fbff);
}

/* Card */
.auth-card{
  background:#fff;
  width:100%;
  max-width:500px;
  padding:36px;
  border-radius:28px;
  box-shadow:0 30px 60px rgba(0,0,0,.12);
  text-align:center;
  margin: 20px;
}

/* Headings */
.auth-card h2{
  margin-bottom:8px;
  color:var(--purple);
  font-size:28px;
}

/* Enrollment Highlight */
.enrollment-info {
  background: #f3f0ff;
  padding: 10px;
  border-radius: 12px;
  margin-bottom: 20px;
  font-size: 14px;
  border: 1px solid #ddd6fe;
  display: none; /* Hidden by default, shown if course data exists */
}

/* Input group */
.input-group{
  position:relative;
  margin-bottom:18px;
  text-align:left;
}

.input-group input,
.input-group select{
  width:100%;
  padding:14px 16px;
  border-radius:14px;
  border:1px solid #ddd;
  outline:none;
  transition:.3s;
}

.input-group input:focus,
.input-group select:focus{
  border-color:var(--purple);
  box-shadow:0 4px 12px rgba(109,40,217,.15);
}

.input-group label{
  position:absolute;
  top:-8px;
  left:12px;
  background:#fff;
  padding:0 6px;
  font-size:12px;
  color:#6b7280;
}

.input-group .toggle-password{
  position:absolute;
  right:12px;
  top:50%;
  transform:translateY(-50%);
  cursor:pointer;
  color:var(--purple);
}

/* Buttons */
.btn{
  width:100%;
  padding:14px;
  border:none;
  border-radius:16px;
  background:linear-gradient(135deg,var(--blue),var(--purple));
  color:#fff;
  font-weight:600;
  font-size:16px;
  cursor:pointer;
  transition:.3s;
  margin-top:10px;
}

.btn:hover{
  transform:scale(1.03);
  box-shadow:0 18px 35px rgba(109,40,217,.45);
}

/* Links */
.link{
  display:block;
  text-align:center;
  margin-top:12px;
  font-size:14px;
  color:var(--purple);
  cursor:pointer;
}

/* Error message */
.error{
  color:#ef4444;
  font-size:14px;
  text-align:center;
  margin-top:8px;
}
</style>
</head>

<body>

<div class="auth-card">
  <h2>Join Academy üç≤</h2>
  
  <div id="enrollmentBanner" class="enrollment-info">
    Registering for: <strong id="courseDisplayName">...</strong>
  </div>

  <p style="color:#6b7280; font-size:14px; margin-bottom:20px;">Create your account to start learning!</p>

  <div class="input-group">
    <label for="fullName">Full Name</label>
    <input type="text" id="fullName" required>
  </div>

  <div class="input-group">
    <label for="email">Email</label>
    <input type="email" id="email" required>
  </div>

  <div class="input-group">
    <label for="password">Password</label>
    <input type="password" id="password" required>
    <i class="fa fa-eye toggle-password" onclick="togglePassword()"></i>
  </div>

  <div class="input-group">
    <label for="phone">Phone Number</label>
    <input type="text" id="phone" required>
  </div>

  <div class="input-group">
    <label for="address">Address</label>
    <input type="text" id="address" required>
  </div>

  <div class="input-group">
    <label for="dob">Date of Birth</label>
    <input type="date" id="dob" required>
  </div>

  <div class="input-group">
    <label for="gender">Gender</label>
    <select id="gender" required>
      <option value="">Select Gender</option>
      <option value="Male">Male</option>
      <option value="Female">Female</option>
      <option value="Other">Other</option>
    </select>
  </div>

  <div class="input-group">
    <label for="country">Country</label>
    <input type="text" id="country" required>
  </div>

  <button class="btn" id="signupBtn" onclick="signup()">Sign Up</button>
  <span class="link" onclick="goToLogin()">Already have an account? Login</span>
  <div id="error" class="error"></div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
firebase.initializeApp({
  apiKey:"AIzaSyC_lKWa4cM4cT337KkRw4sp7raQHl9aZWk",
  authDomain:"students-login-29409.firebaseapp.com",
  projectId:"students-login-29409"
});

const auth = firebase.auth();
const db = firebase.firestore();

// --- 1. GRAB COURSE DETAILS FROM URL ---
const urlParams = new URLSearchParams(window.location.search);
const courseId = urlParams.get('courseId');
const courseName = urlParams.get('name');
const coursePrice = urlParams.get('price');

// If course data exists, update the UI
if (courseId && courseName) {
  document.getElementById('enrollmentBanner').style.display = 'block';
  document.getElementById('courseDisplayName').textContent = courseName;
  document.getElementById('signupBtn').textContent = 'Sign Up & Pay';
}

/* Toggle password visibility */
function togglePassword(){
  const pass = document.getElementById('password');
  pass.type = pass.type === 'password' ? 'text' : 'password';
}

/* Navigation back to login (preserving course data) */
function goToLogin(){
  let target = 'index.html';
  if (courseId) {
    target += `?courseId=${courseId}&name=${encodeURIComponent(courseName)}&price=${coursePrice}`;
  }
  window.location.href = target;
}

/* Sign up */
async function signup(){
  const error = document.getElementById('error');
  const btn = document.getElementById('signupBtn');
  error.textContent = '';

  const fullName = document.getElementById('fullName').value.trim();
  const email = document.getElementById('email').value.trim();
  const password = document.getElementById('password').value;
  const phone = document.getElementById('phone').value.trim();
  const address = document.getElementById('address').value.trim();
  const dob = document.getElementById('dob').value;
  const gender = document.getElementById('gender').value;
  const country = document.getElementById('country').value.trim();

  if(!fullName || !email || !password || !phone || !address || !dob || !gender || !country){
    error.textContent = 'Please fill all required fields';
    return;
  }

  // Disable button to prevent double clicks
  btn.disabled = true;
  btn.textContent = 'Processing...';

  try{
    // Create Firebase Auth account
    const userCredential = await auth.createUserWithEmailAndPassword(email,password);
    const uid = userCredential.user.uid;

    // Save student info in Firestore
    await db.collection('students').doc(uid).set({
      fullName,
      email,
      phone,
      address,
      dob,
      gender,
      country,
      createdAt: firebase.firestore.FieldValue.serverTimestamp()
    });

    // --- 2. DYNAMIC REDIRECT ---
    if (courseId) {
      // If student clicked buy on Blogger, send to payment page with details
      window.location.href = `payment-preview.html?courseId=${courseId}&name=${encodeURIComponent(courseName)}&price=${coursePrice}`;
    } else {
      // Otherwise, go to standard student dashboard
      window.location.href = 'student.html';
    }

  } catch(err){
    console.error(err);
    error.textContent = err.message;
    btn.disabled = false;
    btn.textContent = courseId ? 'Sign Up & Pay' : 'Sign Up';
  }
}
</script>

</body>
</html>
