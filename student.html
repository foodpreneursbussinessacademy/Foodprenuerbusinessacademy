<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>My Classroom | FBA 2026</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&family=Plus+Jakarta+Sans:wght@400;600;700&display=swap" rel="stylesheet" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />

<style>
:root {
    /* 2026 Color Palette */
    --bg-dark: #0f172a;
    --glass-surface: rgba(255, 255, 255, 0.65);
    --glass-border: rgba(255, 255, 255, 0.8);
    --glass-highlight: rgba(255, 255, 255, 0.9);
    --primary-gradient: linear-gradient(135deg, #6366f1 0%, #a855f7 100%);
    --accent-glow: 0 0 20px rgba(99, 102, 241, 0.4);
    --text-main: #1e293b;
    --text-muted: #64748b;
    
    /* Animation Speeds */
    --ease-elastic: cubic-bezier(0.34, 1.56, 0.64, 1);
}

* { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }

body {
    margin: 0;
    font-family: 'Outfit', sans-serif;
    background: #f0f4f8;
    color: var(--text-main);
    min-height: 100vh;
    overflow-x: hidden;
}

/* --- DYNAMIC BACKGROUND BLOB ANIMATION --- */
.bg-blobs {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
    background: radial-gradient(circle at 0% 0%, #e0e7ff 0%, #f3e8ff 50%, #f0f9ff 100%);
    overflow: hidden;
}
.blob {
    position: absolute;
    filter: blur(60px);
    z-index: -1;
    opacity: 0.6;
    animation: float 20s infinite ease-in-out alternate;
}
.blob-1 { top: -10%; left: -10%; width: 50vw; height: 50vw; background: #c7d2fe; animation-delay: 0s; }
.blob-2 { bottom: -10%; right: -10%; width: 60vw; height: 60vw; background: #e9d5ff; animation-delay: -5s; }
.blob-3 { top: 30%; left: 40%; width: 30vw; height: 30vw; background: #bae6fd; animation-delay: -10s; }

@keyframes float { 
    0% { transform: translate(0, 0) scale(1); } 
    100% { transform: translate(20px, 40px) scale(1.1); } 
}

/* --- LAYOUT GRID --- */
.dashboard-layout {
    display: grid;
    grid-template-columns: 260px 1fr;
    min-height: 100vh;
}

/* --- SIDEBAR GLASS --- */
.sidebar {
    background: rgba(255, 255, 255, 0.4);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border-right: 1px solid rgba(255, 255, 255, 0.5);
    padding: 30px 20px;
    display: flex;
    flex-direction: column;
    position: sticky;
    top: 0;
    height: 100vh;
    z-index: 10;
}

.brand {
    font-size: 1.5rem;
    font-weight: 800;
    background: var(--primary-gradient);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    margin-bottom: 40px;
    display: flex; align-items: center; gap: 10px;
}

.nav-item {
    display: flex; align-items: center; gap: 15px;
    padding: 14px 18px;
    margin-bottom: 8px;
    text-decoration: none;
    color: var(--text-muted);
    font-weight: 600;
    border-radius: 16px;
    transition: all 0.3s var(--ease-elastic);
    position: relative;
    overflow: hidden;
}

.nav-item i { font-size: 1.1rem; width: 24px; text-align: center; transition: 0.3s; }

.nav-item:hover, .nav-item.active {
    background: white;
    color: #4f46e5;
    box-shadow: 0 4px 20px rgba(0,0,0,0.05);
}
.nav-item:hover i { transform: scale(1.2) rotate(-10deg); color: #818cf8; }

.btn-logout { margin-top: auto; color: #ef4444; background: rgba(254, 226, 226, 0.5); }
.btn-logout:hover { background: #fee2e2; color: #dc2626; }

/* --- MAIN CONTENT --- */
.main-content {
    padding: 40px 5%;
    max-width: 1400px;
    margin: 0 auto;
    width: 100%;
}

/* --- HEADER SECTION --- */
.header-welcome {
    display: flex; justify-content: space-between; align-items: flex-end;
    margin-bottom: 40px;
    animation: slideDown 0.6s ease-out;
}

.welcome-text h1 {
    font-size: 2.5rem; font-weight: 700; margin: 0;
    background: linear-gradient(to right, #1e293b, #4f46e5);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}
.welcome-text p { color: var(--text-muted); font-size: 1.1rem; margin-top: 5px; }

.user-pill {
    background: white; padding: 8px 16px; border-radius: 50px;
    display: flex; align-items: center; gap: 10px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.05);
}
.user-avatar {
    width: 35px; height: 35px; border-radius: 50%;
    background: var(--primary-gradient);
    color: white; font-weight: bold;
    display: flex; align-items: center; justify-content: center;
}

/* --- 3D INSTRUCTION CARD --- */
.instruction-banner {
    background: linear-gradient(120deg, #6366f1, #8b5cf6);
    border-radius: 24px;
    padding: 30px;
    color: white;
    position: relative;
    overflow: hidden;
    margin-bottom: 40px;
    box-shadow: 0 20px 40px -10px rgba(99, 102, 241, 0.4);
    animation: fadeIn 0.8s ease-out;
    display: flex; align-items: center; justify-content: space-between;
}
.instruction-banner::before {
    content: ''; position: absolute; top: -50%; left: -20%; width: 200%; height: 200%;
    background: url('https://grainy-gradients.vercel.app/noise.svg');
    opacity: 0.1;
}
.instruction-text { z-index: 2; max-width: 600px; }
.instruction-text h2 { margin: 0 0 10px 0; font-size: 1.8rem; }
.instruction-text p { margin: 0; opacity: 0.9; font-size: 1rem; line-height: 1.6; }

/* 3D Icon Simulation */
.icon-3d-box {
    font-size: 4rem;
    background: rgba(255,255,255,0.2);
    width: 80px; height: 80px;
    display: flex; align-items: center; justify-content: center;
    border-radius: 20px;
    backdrop-filter: blur(5px);
    box-shadow: 0 15px 35px rgba(0,0,0,0.2);
    transform: rotate(-10deg);
    border: 1px solid rgba(255,255,255,0.3);
}

/* --- COURSES GRID --- */
.grid-label {
    font-size: 1.2rem; font-weight: 700; margin-bottom: 20px;
    display: flex; align-items: center; gap: 10px;
}
.grid-label::before { content: ''; width: 4px; height: 24px; background: #4f46e5; border-radius: 4px; }

.courses-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    gap: 30px;
    padding-bottom: 40px;
}

/* --- NEW CARD DESIGN --- */
.course-card {
    background: var(--glass-surface);
    border: 1px solid var(--glass-border);
    border-radius: 24px;
    padding: 25px;
    position: relative;
    transition: all 0.4s var(--ease-elastic);
    display: flex; flex-direction: column;
    cursor: default;
    box-shadow: 0 10px 30px -10px rgba(0,0,0,0.05);
}

.course-card:hover {
    transform: translateY(-10px);
    box-shadow: 0 20px 40px -12px rgba(99, 102, 241, 0.2);
    background: white;
    border-color: #c7d2fe;
}

.card-icon {
    width: 50px; height: 50px;
    background: #e0e7ff;
    color: #4338ca;
    border-radius: 14px;
    display: flex; align-items: center; justify-content: center;
    font-size: 1.4rem;
    margin-bottom: 20px;
    box-shadow: inset 0 0 0 1px rgba(255,255,255,0.5);
}

.course-title {
    font-size: 1.3rem; font-weight: 700;
    margin: 0 0 10px 0; color: var(--text-main);
    line-height: 1.3;
}

.course-desc {
    font-size: 0.9rem; color: var(--text-muted);
    line-height: 1.6; margin-bottom: 25px;
    flex-grow: 1;
}

.progress-indicator {
    display: flex; align-items: center; gap: 8px;
    font-size: 0.8rem; font-weight: 600; color: #10b981;
    margin-bottom: 15px;
    background: #ecfdf5; padding: 6px 12px; border-radius: 30px; width: fit-content;
}

.btn-enter {
    width: 100%;
    padding: 14px;
    border-radius: 14px;
    border: none;
    font-weight: 600;
    font-size: 1rem;
    cursor: pointer;
    background: var(--text-main);
    color: white;
    display: flex; align-items: center; justify-content: center; gap: 8px;
    transition: all 0.2s;
}
.btn-enter:hover {
    background: #4f46e5;
    box-shadow: 0 4px 15px rgba(79, 70, 229, 0.4);
    transform: scale(1.02);
}

/* --- EMPTY STATE --- */
.empty-state {
    grid-column: 1 / -1;
    text-align: center;
    padding: 60px;
    background: rgba(255,255,255,0.5);
    border-radius: 30px;
    border: 2px dashed #cbd5e1;
}
.empty-icon { font-size: 3rem; color: #cbd5e1; margin-bottom: 20px; }
.btn-catalog {
    background: var(--primary-gradient); color: white; padding: 12px 24px;
    border-radius: 50px; text-decoration: none; font-weight: 600;
    display: inline-block; margin-top: 15px;
    box-shadow: var(--accent-glow);
}

/* Animations */
@keyframes slideDown { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

/* Mobile */
@media(max-width: 900px) {
    .dashboard-layout { grid-template-columns: 1fr; }
    .sidebar { display: none; } /* Could add hamburger menu logic here, sticking to clean request */
    .instruction-banner { flex-direction: column; text-align: center; gap: 20px; }
    .instruction-text { text-align: left; }
    .icon-3d-box { display: none; }
}
</style>
</head>

<body>

<div class="bg-blobs">
    <div class="blob blob-1"></div>
    <div class="blob blob-2"></div>
    <div class="blob blob-3"></div>
</div>

<div class="dashboard-layout">
    <aside class="sidebar">
        <div class="brand">
            <i class="fa-solid fa-graduation-cap"></i> FBA Portal
        </div>
        
        <nav style="flex-grow: 1;">
            <a href="#" class="nav-item active"><i class="fa-solid fa-layer-group"></i> My Classroom</a>
            <a href="progress.html" class="nav-item"><i class="fa-solid fa-chart-pie"></i> Progress</a>
            <a href="courses.html" class="nav-item"><i class="fa-solid fa-compass"></i> Course Catalog</a>
            <a href="certificates.html" class="nav-item"><i class="fa-solid fa-medal"></i> Certificates</a>
            <a href="tickets.html" class="nav-item"><i class="fa-solid fa-headset"></i> Support Tickets</a>
            <a href="profile.html" class="nav-item"><i class="fa-solid fa-user-gear"></i> Profile</a>
        </nav>

        <a href="#" onclick="logout()" class="nav-item btn-logout"><i class="fa-solid fa-right-from-bracket"></i> Log Out</a>
    </aside>

    <main class="main-content">
        
        <header class="header-welcome">
            <div class="welcome-text">
                <h1>Hello, <span id="studentName">Scholar</span></h1>
                <p>Ready to continue your business mastery today?</p>
            </div>
            <div class="user-pill">
                <div class="user-avatar" id="avatarInitial">S</div>
                <small style="font-weight:600; color:#64748b;" id="studentId">ID: Loading...</small>
            </div>
        </header>

        <div class="instruction-banner">
            <div class="instruction-text">
                <h2>Your Active Enrollments [attachment_0](attachment)</h2>
                <p>Welcome to your dedicated learning space. Only the courses you have successfully purchased and been approved for appear below. Click "Enter Class" to resume your studies immediately.</p>
            </div>
            <div class="icon-3d-box">
                <i class="fa-solid fa-rocket" style="color:white;"></i>
            </div>
        </div>

        <div class="grid-label">Access Your Content</div>

        <div class="courses-grid" id="coursesGrid">
            <div style="grid-column:1/-1; text-align:center; color:#64748b; padding:40px;">
                <i class="fas fa-circle-notch fa-spin"></i> Synchronizing your database...
            </div>
        </div>

    </main>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
/* 1. INITIALIZE FIREBASE */
const firebaseConfig = {
  apiKey: "AIzaSyC_lKWa4cM4cT337KkRw4sp7raQHl9aZWk",
  authDomain: "students-login-29409.firebaseapp.com",
  projectId: "students-login-29409",
  storageBucket: "students-login-29409.firebasestorage.app",
  messagingSenderId: "634331456872",
  appId: "1:634331456872:web:6dae360c5e28d8356562dd",
  measurementId: "G-96XXYG1VR2"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

/* 2. COURSE DATABASE */
const coursesData = [
  {
    name: "Food Business Management Course",
    icon: "fa-briefcase",
    overview: "Master the ecosystem of running a compliant and profitable food business.",
    link: "course-food-business-management.html"
  },
  {
    name: "Financial Management for Food Processors",
    icon: "fa-calculator",
    overview: "Learn unit costing, yield analysis, and cash flow specifically for food production.",
    link: "course-financial-management.html"
  },
  {
    name: "Food Value Addition Course for Farmers",
    icon: "fa-leaf",
    overview: "Techniques to process, package, and brand your harvest for higher market value.",
    link: "course-value-addition.html"
  },
  {
    name: "New Product Development and Management",
    icon: "fa-flask",
    overview: "Take an idea from a kitchen recipe to a shelf-stable commercial product.",
    link: "course-product-development.html"
  },
  {
    name: "Management",
    icon: "fa-users",
    overview: "Leadership tactics for high-pressure food environments.",
    link: "management_course.html"
  }
];

/* 3. LOGIC */
auth.onAuthStateChanged(async (user) => {
  if (!user) {
    window.location.href = 'index.html'; 
    return;
  }

  // Set Profile UI
  const name = user.displayName || user.email.split('@')[0];
  document.getElementById('studentName').textContent = name;
  document.getElementById('studentId').textContent = `ID: ${user.uid.slice(0, 6).toUpperCase()}`;
  document.getElementById('avatarInitial').textContent = name.charAt(0).toUpperCase();

  // Fetch Paid Data
  try {
    const doc = await db.collection('students').doc(user.uid).get();
    let paidList = [];
    
    if (doc.exists) {
      paidList = doc.data().coursesPaid || [];
    }

    renderDashboard(paidList);

  } catch (err) {
    console.error("Error:", err);
    document.getElementById('coursesGrid').innerHTML = `<p style="color:red">Error loading profile.</p>`;
  }
});

function renderDashboard(paidList) {
  const grid = document.getElementById("coursesGrid");
  grid.innerHTML = ""; // Clear loader

  // FILTER: Only show courses that are in the paidList
  const myCourses = coursesData.filter(course => paidList.includes(course.name));

  // EMPTY STATE
  if (myCourses.length === 0) {
    grid.innerHTML = `
      <div class="empty-state">
        <div class="empty-icon"><i class="fa-regular fa-folder-open"></i></div>
        <h3>No Active Courses Yet</h3>
        <p>You haven't enrolled in any courses yet. Visit the catalog to start learning.</p>
        <a href="courses.html" class="btn-catalog">Browse Catalog</a>
      </div>
    `;
    return;
  }

  // RENDER CARDS
  myCourses.forEach((course, index) => {
    // Stagger animation delay based on index
    const delay = index * 100; 
    
    grid.innerHTML += `
      <div class="course-card" style="animation: fadeIn 0.5s ease-out ${delay}ms forwards; opacity:0">
        <div class="card-icon">
            <i class="fa-solid ${course.icon}"></i>
        </div>
        <div class="status-indicator">
            
        </div>
        <h3 class="course-title">${course.name}</h3>
        <div class="progress-indicator">
            <i class="fa-solid fa-check-circle"></i> Active & Enrolled
        </div>
        <p class="course-desc">${course.overview}</p>
        
        <button class="btn-enter" onclick="window.location.href='${course.link}'">
            Enter Class <i class="fa-solid fa-arrow-right"></i>
        </button>
      </div>
    `;
  });
}

window.logout = function() {
  auth.signOut().then(() => window.location.href = 'index.html');
}
</script>

</body>
</html>
